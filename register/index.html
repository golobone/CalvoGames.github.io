<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAqprLLzZIfM2WnJsHISksgraZ2NJnQnRw",
        authDomain: "calvogames-v1.firebaseapp.com",
        projectId: "calvogames-v1",
        storageBucket: "calvogames-v1.firebasestorage.app",
        messagingSenderId: "490748488828",
        appId: "1:490748488828:web:eb32857a4e203ce33b6df9"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    document.getElementById('registerBtn').onclick = async () => {
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        const status = document.getElementById('status');

        try {
            // CREAR USUARIO
            const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
            
            // GUARDAR NOMBRE EN EL PERFIL
            await updateProfile(userCredential.user, { displayName: name });

            // GUARDAR EN LA BASE DE DATOS (Lo que acabas de crear)
            await setDoc(doc(db, "users", userCredential.user.uid), {
                nombre: name,
                correo: email,
                fecha: new Date()
            });

            status.innerText = "¡Registrado con éxito! Redirigiendo...";
            setTimeout(() => window.location.href = "../index.html", 2000);

        } catch (error) {
            console.error("Error completo:", error);
            status.innerText = "Error: " + error.message;
        }
    };
</script>
