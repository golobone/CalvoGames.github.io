<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore-compat.js"></script>

<script>
    // 2. Tu configuración
    const firebaseConfig = {
        apiKey: "AIzaSyAqprLLzZIfM2WnJsHISksgraZ2NJnQnRw",
        authDomain: "calvogames-v1.firebaseapp.com",
        projectId: "calvogames-v1",
        storageBucket: "calvogames-v1.firebasestorage.app",
        messagingSenderId: "490748488828",
        appId: "1:490748488828:web:eb32857a4e203ce33b6df9"
    };

    // 3. Inicializar Firebase (Versión Compat)
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // 4. Lógica del botón
    const btn = document.getElementById('registerBtn');
    const statusMsg = document.getElementById('status');

    btn.onclick = async function() {
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const pass = document.getElementById('password').value.trim();

        if (!name || !email || !pass) {
            statusMsg.innerText = "❌ Rellena todos los campos";
            return;
        }

        statusMsg.innerText = "⏳ Registrando en Firebase...";
        console.log("Enviando datos...");

        try {
            // Crear usuario
            const userCred = await auth.createUserWithEmailAndPassword(email, pass);
            
            // Guardar nombre en el perfil
            await userCred.user.updateProfile({ displayName: name });

            // Guardar en la base de datos
            await db.collection("users").doc(userCred.user.uid).set({
                username: name,
                email: email,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });

            statusMsg.innerText = "✅ ¡CONSEGUIDO! Redirigiendo...";
            setTimeout(() => {
                window.location.href = "../index.html";
            }, 2000);

        } catch (error) {
            console.error("Error detallado:", error);
            
            // Mensajes de error amigables
            if (error.code === 'auth/email-already-in-use') {
                statusMsg.innerText = "❌ Este correo ya tiene cuenta.";
            } else if (error.code === 'auth/weak-password') {
                statusMsg.innerText = "❌ La contraseña es muy corta.";
            } else {
                statusMsg.innerText = "❌ Error: " + error.message;
            }
        }
    };
</script>

