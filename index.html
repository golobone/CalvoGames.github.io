<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalvoGames | Juegos Indie</title>
    
    <meta name="description" content="CalvoGames es una web de juegos indie y proyectos en desarrollo con descargas directas.">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">

    <meta property="og:title" content="CalvoGames">
    <meta property="og:description" content="Juegos indie en desarrollo con descarga directa.">
    <meta property="og:image" content="/preview.png">
    <meta property="og:url" content="https://calvogames.pages.dev">
    <meta property="og:type" content="website">

    <style>
        :root {
            --primary-bg: #1a1a1a;
            --accent-color: #ff9800;
            --text-main: #ffffff;
            --admin-color: #f44336;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-main);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .header-cg {
            width: 100%;
            padding: 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: #252525;
        }
        .user-badge {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        .btn-panel {
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            display: none; /* Se activa por JS */
        }
        .btn-owner-cg { background: #4caf50; color: white; }
        .btn-admin-cg { background: var(--admin-color); color: white; }
        .btn-sesion-cg { cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body>

    <header class="header-cg">
        <h1>CalvoGames</h1>
        <div class="user-badge" id="cg-auth-container">
            <div id="user-avatar">?</div>
            <div id="user-info">
                <span id="cg-user-name">Cargando...</span>
                <div id="session-action"></div>
            </div>
            <a href="#" id="panel-btn" class="btn-panel"></a>
        </div>
    </header>

    <main>
        <p style="text-align:center; margin-top:50px;">Bienvenido a la zona de proyectos.</p>
    </main>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

    <script>
        // CONFIGURACIÓN (Asegúrate de inicializar Firebase aquí)
        const OWNER_EMAIL = "tu-email-de-owner@gmail.com"; //

        const checkAuth = () => {
            const auth = firebase.auth();
            const db = firebase.firestore();
            const nameLabel = document.getElementById('cg-user-name');
            const avatar = document.getElementById('user-avatar');
            const actionArea = document.getElementById('session-action');
            const panelBtn = document.getElementById('panel-btn');

            auth.onAuthStateChanged((user) => {
                if (user) {
                    nameLabel.innerText = user.displayName || "Usuario"; //
                    avatar.innerText = (user.displayName || "U").charAt(0).toUpperCase();
                    avatar.style.background = "#ff9800";
                    actionArea.innerHTML = '<span class="btn-sesion-cg" id="cg-logout">Cerrar Sesión</span>';

                    document.getElementById('cg-logout').onclick = () => auth.signOut().then(() => location.reload());

                    // Lógica de Roles
                    if (user.email === OWNER_EMAIL) {
                        panelBtn.style.display = "block";
                        panelBtn.className = "btn-panel btn-owner-cg";
                        panelBtn.innerText = "⭐ OWNER PANEL";
                    } else {
                        db.collection("users").doc(user.uid).get().then((doc) => {
                            if (doc.exists && doc.data().rol === "admin") { //
                                panelBtn.style.display = "block";
                                panelBtn.className = "btn-panel btn-admin-cg";
                                panelBtn.innerText = "⚙️ ADMIN PANEL";
                            }
                        });
                    }
                } else {
                    avatar.innerText = "?";
                    avatar.style.background = "#555";
                    nameLabel.innerText = "Invitado";
                    panelBtn.style.display = "none";
                    actionArea.innerHTML = '<a href="login/" style="color:white">Iniciar Sesión</a>';
                }
            });
        };

        // Ejecutar al cargar
        window.onload = checkAuth;
    </script>
</body>
</html>